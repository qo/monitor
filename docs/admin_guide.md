# Установка программы

Чтобы загрузить исходный код, следует склонировать [git-репозиторий](https://github.com/qo/monitor), расположенный на Github. Для этого на сервере должен быть установлен git. В случае, если на сервере установлена ОС Linux, следует ввести следующую команду в командную строку:

```sh
git clone https://github.com/qo/monitor`
```

Программа не поставляется в виде исходного файла, так как система плагинов реализована в виде статических библиотек исходного кода.

# Настройка программы

Для работы программы подойдут настройки по умолчанию, однако для использования тестового публикующего плагина для Telegram необходимо создать Telegram-бота и написать простейший shell-скрипт для определения переменной среды, в которой содержится токен к созданному боту.

## Создание Telegram-бота

Чтобы создать Telegram-бота, необходимо написать боту в Telegram с именем пользователя [`@BotFather`](https://t.me/BotFather). Затем необходимо следовать указаниям этого бота, чтобы получить токен нового Telegram-бота.

## Создание shell-скрипта для экспорта токена Telegram-бота

Чтобы использовать токен Telegram-бота, следует написать shell-скрипт, который будет определять переменную среды `MONITOR_TELEGRAM_BOT_TOKEN`.

### Создание файла

Необходимо создать файл `export_env.sh` в корне проекта с помощью следующей команды:

```sh
touch export_env.sh
```

### Написание скрипта

Необходимо заполнить созданный файл следующим кодом:

```sh
#!/bin/sh
export MONITOR_TELEGRAM_BOT_TOKEN=ТОКЕН
```

Вместо слова `ТОКЕН` следует указать токен созданного Telegram-бота.

## Указание права на исполнение

Чтобы сделать созданный скрипт исполяемым, следует ввести следующую команду:

```sh
chmod +x ./export_env.sh
```

## Изменение конфигурации программы

В корне проекта существует файл `monitor.conf`, в котором указана конфигурация программы. Файл конфигурации является файлом формата JSON и имеет следующие поля:

- `host` - хост, на котором запускается пользовательский интерфейс;
- `port` - порт, на котором запускается пользовательский интерфейс;
- `database_path` - путь к используемой базе данных;
- `delay_seconds` - задержка в секундах между проверками статусов сервисов.

Файлы конфигурации существуют также для тестового сервиса httpd и тестового публикующего плагина для Telegram.

# Запуск программы

Для запуска программы необходим установленный компилятор языка программирования Go. В случае, если на сервере установлена ОС Linux, следует установить его через пакетный менеджер, либо воспользоваться инструкциями на официальном сайте языка.

Чтобы запустить программу, необходимо запустить скрипт `run.sh`. Для этого, перейдя в корень репозитория, следует ввести следующую команду в командную строку:

```sh
./run.sh
```

# Тестирование программы

Для запуска тестов необходим установленный компилятор языка программирования Go.

Чтобы протестировать программу, необходимо запустить скрипт `test.sh`. Для этого, перейдя в корень репозитория, следует ввести следующую команду в командную строку:

```sh
./test.sh
```

# Создание плагинов

Чтобы создать опрашивающий или публикующий плагин, следует создать пакет в директории `plugins/pollers` или `plugins/notifiers` соответственно.

В пакете опрашивающего плагина следует создать тип (можно без полей) с методами, соответствующими интерфейсу `plugins.Poller`. Аналогично в пакете публикующего плагина следует создать структуру (можно без полей) с методами, соответствующими интерфейсу `plugins.Notifier`. Интерфейсы описаны в файле `internal/plugins/plugins.go`.

Затем следует объявить и экспортировать переменную созданного типа.

Для изучения синтаксиса языка программирования Go можно обратиться к следующим источникам:

- [A Tour of Go](https://go.dev/tour/welcome/1);
- [The Go Programming Language (Alan A. A. Donovan, Brian W. Kernighan)](https://books.google.ru/books/about/The_Go_Programming_Language.html?id=SJHvCgAAQBAJ&source=kp_book_description&redir_esc=y).

# Использование плагинов

Чтобы использовать плагин, его следует импортировать в модуль `core`, а именно в файл `internal/core/pollers.go` или `internal/core/notifiers.go`, добавив объявленную переменную в список `pollerPlugins` или `notifierPlugins` соответственно.

# Получение идентификатора пользователя в Telegram

Так как любой пользователь может сменить своё имя пользователя в любой момент, для идентификации используется уникальный идентификатор. Данный уникальный идентификатор можно получить с помощью бота в Telegram с именем пользователя [@userinfobot](https://t.me/userinfobot). В случае, если данный бот не доступен, его можно запустить самостоятельно. Код бота расположен в [git-репозитории на Github](https://github.com/nadam/userinfobot).
